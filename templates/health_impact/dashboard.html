{% extends "base.html" %}

{% block title %}Health Impact - Nicotine Tracker{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">Health Impact Dashboard</h1>

    <!-- Add Health Impact Form -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-800 dark:text-white mb-4">Record Health Metrics</h2>
        <form id="health-impact-form">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="blood_pressure" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Blood Pressure</label>
                    <input type="text" id="blood_pressure" name="blood_pressure" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="heart_rate" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Heart Rate (bpm)</label>
                    <input type="number" id="heart_rate" name="heart_rate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="gum_health" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Gum Health</label>
                    <select id="gum_health" name="gum_health" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option>Good</option>
                        <option>Fair</option>
                        <option>Poor</option>
                    </select>
                </div>
                <div>
                    <label for="anxiety_level" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Anxiety Level (1-10)</label>
                    <input type="range" id="anxiety_level" name="anxiety_level" min="1" max="10" class="mt-1 block w-full">
                </div>
                <div>
                    <label for="focus_level" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Focus Level (1-10)</label>
                    <input type="range" id="focus_level" name="focus_level" min="1" max="10" class="mt-1 block w-full">
                </div>
                <div>
                    <label for="mood" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Mood</label>
                    <input type="text" id="mood" name="mood" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
            </div>
            <div class="mt-6">
                <label for="notes" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Notes</label>
                <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
            </div>
            <div class="mt-6">
                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">Save Record</button>
            </div>
        </form>
    </div>

    <!-- Health Impact History -->
    <div id="health-impact-history">
        <!-- Data will be loaded here -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('health-impact-form');
    const historyContainer = document.getElementById('health-impact-history');

    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        fetch('/health_impact/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                loadHealthData();
                form.reset();
            }
        });
    });

    function loadHealthData() {
        fetch('/health_impact/data')
            .then(response => response.json())
            .then(data => {
                historyContainer.innerHTML = '';
                data.forEach(record => {
                    const recordElement = document.createElement('div');
                    recordElement.className = 'bg-white dark:bg-gray-800 shadow rounded-lg p-6 mb-4';
                    recordElement.innerHTML = `
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Record from ${new Date(record.created_at).toLocaleString()}</h3>
                        <p><strong>Blood Pressure:</strong> ${record.blood_pressure}</p>
                        <p><strong>Heart Rate:</strong> ${record.heart_rate} bpm</p>
                        <p><strong>Gum Health:</strong> ${record.gum_health}</p>
                        <p><strong>Anxiety Level:</strong> ${record.anxiety_level}/10</p>
                        <p><strong>Focus Level:</strong> ${record.focus_level}/10</p>
                        <p><strong>Mood:</strong> ${record.mood}</p>
                        <p><strong>Notes:</strong> ${record.notes}</p>
                    `;
                    historyContainer.appendChild(recordElement);
                });
            });
    }

    loadHealthData();
});
</script>
{% endblock %}
